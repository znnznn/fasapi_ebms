import time

import aioodbc
import pyodbc

from database import get_embs_connection
from settings import EBMS_DB

start_time = time.time()
connectionString = f'DRIVER={{ODBC Driver 17 for SQL Server}};SERVER={EBMS_DB.DB_HOST};DATABASE={EBMS_DB.DB_NAME};UID={EBMS_DB.DB_USER};PWD={EBMS_DB.DB_PASS};PORT={EBMS_DB.DB_PORT}'

conn = pyodbc.connect(connectionString)

cursor = conn.cursor()
async_conn = get_embs_connection()

data = cursor.execute("""SELECT TOP 10 "ARINVDET"."ARINVDET_GUID", "ARINVDET"."RECNO5", "ARINVDET"."INVOICE", "ARINVDET"."ID", "ARINVDET"."DOC_TYPE", "ARINVDET"."DOC_AID", "ARINVDET"."INV_DATE", "ARINVDET"."QUAN", "ARINVDET"."SHIP", "ARINVDET"."M_QUAN", "ARINVDET"."ORIG_QUAN", "ARINVDET"."INVEN", "ARINVDET"."C_TYPE", "ARINVDET"."UNIT_MEAS", "ARINVDET"."DESCR", "ARINVDET"."UNIT", "ARINVDET"."PRICE", "ARINVDET"."SO_AMOUNT", "ARINVDET"."DISCOUNT", "ARINVDET"."SODISCOUNT", "ARINVDET"."TIMESTAMP", "ARINVDET"."PAR_TIME", "ARINVDET"."GPAR_TIME", "ARINVDET"."STATUS", "ARINVDET"."U_COST", "ARINVDET"."COSTS", "ARINVDET"."TAX_GROUP", "ARINVDET"."EXM_OVERID", "ARINVDET"."SHIP_DATE", "ARINVDET"."WEIGHT", "ARINVDET"."PRINT", "ARINVDET"."AP_PARTIME", "ARINVDET"."PRINT_QUAN", "ARINVDET"."PRINT_UOM", "ARINVDET"."ACCOUNT", "ARINVDET"."WAREHOUSE", "ARINVDET"."AUTOID", "ARINVDET"."PCM_TYPE", "ARINVDET"."PCM_PERC", "ARINVDET"."MTO", "ARINVDET"."MTO_D_SYNC", "ARINVDET"."DROP_VEN", "ARINVDET"."DROP_PART", "ARINVDET"."DROP_AID", "ARINVDET"."PURC_METH", "ARINVDET"."C_PRICE", "ARINVDET"."C_UNIT", "ARINVDET"."FXLINE", "ARINVDET"."C_FORMULA", "ARINVDET"."WIDTH", "ARINVDET"."WIDTHD", "ARINVDET"."HEIGHT", "ARINVDET"."HEIGHTD", "ARINVDET"."DEM", "ARINVDET"."DEMD", "ARINVDET"."MANUAL_P", "ARINVDET"."MANUAL_C", "ARINVDET"."ROUND", "ARINVDET"."COMMENT", "ARINVDET"."EA_QUAN", "ARINVDET"."R_EA_QUAN", "ARINVDET"."REPORT_N", "ARINVDET"."RANDOM_W", "ARINVDET"."RANDOM_H", "ARINVDET"."ITEM_NUM", "ARINVDET"."FEET", "ARINVDET"."INCHESD", "ARINVDET"."INCHES", "ARINVDET"."C_MFG", "ARINVDET"."R_SERIAL", "ARINVDET"."SU_AUTOID", "ARINVDET"."TRADE_IN", "ARINVDET"."IN_LEVEL", "ARINVDET"."JOB_ID", "ARINVDET"."JOBSTG_ID", "ARINVDET"."AIA", "ARINVDET"."RETN_TYPE", "ARINVDET"."RETN_PERC", "ARINVDET"."INT_NOTE", "ARINVDET"."TAX_EXPL", "ARINVDET"."ON_SITE" 
                FROM "ARINVDET" 
                WHERE "ARINVDET"."INV_DATE" >= '2023-01-01' AND "ARINVDET"."PAR_TIME" = '' AND (SELECT "INVENTRY"."PROD_TYPE" 
                FROM "INVENTRY" 
                WHERE "INVENTRY"."ID" = "ARINVDET"."INVEN") != '' AND (SELECT "INVENTRY"."PROD_TYPE" 
                FROM "INVENTRY" 
                WHERE "INVENTRY"."ID" = "ARINVDET"."INVEN") != 'Vents' AND "ARINVDET"."INVEN" IS NOT NULL AND "ARINVDET"."INVEN" != '' AND ("ARINVDET"."AUTOID" NOT IN ('1L3KKNIGQ3GQCL01', 'Q6F01NHMDU9J0G11', 'PSRKR559J2C7HEH0', '4I86DSG9DK6JIO51', '0B8H1NHMDU9J0G11')) GROUP BY "ARINVDET"."ARINVDET_GUID", "ARINVDET"."RECNO5", "ARINVDET"."INVOICE", "ARINVDET"."ID", "ARINVDET"."DOC_TYPE", "ARINVDET"."DOC_AID", "ARINVDET"."INV_DATE", "ARINVDET"."QUAN", "ARINVDET"."SHIP", "ARINVDET"."M_QUAN", "ARINVDET"."ORIG_QUAN", "ARINVDET"."INVEN", "ARINVDET"."C_TYPE", "ARINVDET"."UNIT_MEAS", "ARINVDET"."DESCR", "ARINVDET"."UNIT", "ARINVDET"."PRICE", "ARINVDET"."SO_AMOUNT", "ARINVDET"."DISCOUNT", "ARINVDET"."SODISCOUNT", "ARINVDET"."TIMESTAMP", "ARINVDET"."PAR_TIME", "ARINVDET"."GPAR_TIME", "ARINVDET"."STATUS", "ARINVDET"."U_COST", "ARINVDET"."COSTS", "ARINVDET"."TAX_GROUP", "ARINVDET"."EXM_OVERID", "ARINVDET"."SHIP_DATE", "ARINVDET"."WEIGHT", "ARINVDET"."PRINT", "ARINVDET"."AP_PARTIME", "ARINVDET"."PRINT_QUAN", "ARINVDET"."PRINT_UOM", "ARINVDET"."ACCOUNT", "ARINVDET"."WAREHOUSE", "ARINVDET"."AUTOID", "ARINVDET"."PCM_TYPE", "ARINVDET"."PCM_PERC", "ARINVDET"."MTO", "ARINVDET"."MTO_D_SYNC", "ARINVDET"."DROP_VEN", "ARINVDET"."DROP_PART", "ARINVDET"."DROP_AID", "ARINVDET"."PURC_METH", "ARINVDET"."C_PRICE", "ARINVDET"."C_UNIT", "ARINVDET"."FXLINE", "ARINVDET"."C_FORMULA", "ARINVDET"."WIDTH", "ARINVDET"."WIDTHD", "ARINVDET"."HEIGHT", "ARINVDET"."HEIGHTD", "ARINVDET"."DEM", "ARINVDET"."DEMD", "ARINVDET"."MANUAL_P", "ARINVDET"."MANUAL_C", "ARINVDET"."ROUND", "ARINVDET"."COMMENT", "ARINVDET"."EA_QUAN", "ARINVDET"."R_EA_QUAN", "ARINVDET"."REPORT_N", "ARINVDET"."RANDOM_W", "ARINVDET"."RANDOM_H", "ARINVDET"."ITEM_NUM", "ARINVDET"."FEET", "ARINVDET"."INCHESD", "ARINVDET"."INCHES", "ARINVDET"."C_MFG", "ARINVDET"."R_SERIAL", "ARINVDET"."SU_AUTOID", "ARINVDET"."TRADE_IN", "ARINVDET"."IN_LEVEL", "ARINVDET"."JOB_ID", "ARINVDET"."JOBSTG_ID", "ARINVDET"."AIA", "ARINVDET"."RETN_TYPE", "ARINVDET"."RETN_PERC", "ARINVDET"."INT_NOTE", "ARINVDET"."TAX_EXPL", "ARINVDET"."ON_SITE" ORDER BY CASE "ARINVDET"."AUTOID" WHEN 'CHVN1KKAET2NF130' THEN 1 WHEN 'QF0P32IMDU9J0G11' THEN 2 ELSE -1 END

""")

data = cursor.fetchall()
for row in data:
    print(row)

data = cursor.execute("""SELECT TOP 10 "ARINVDET"."ARINVDET_GUID", "ARINVDET"."RECNO5", "ARINVDET"."INVOICE", "ARINVDET"."ID", "ARINVDET"."DOC_TYPE", "ARINVDET"."DOC_AID", "ARINVDET"."INV_DATE", "ARINVDET"."QUAN", "ARINVDET"."SHIP", "ARINVDET"."M_QUAN", "ARINVDET"."ORIG_QUAN", "ARINVDET"."INVEN", "ARINVDET"."C_TYPE", "ARINVDET"."UNIT_MEAS", "ARINVDET"."DESCR", "ARINVDET"."UNIT", "ARINVDET"."PRICE", "ARINVDET"."SO_AMOUNT", "ARINVDET"."DISCOUNT", "ARINVDET"."SODISCOUNT", "ARINVDET"."TIMESTAMP", "ARINVDET"."PAR_TIME", "ARINVDET"."GPAR_TIME", "ARINVDET"."STATUS", "ARINVDET"."U_COST", "ARINVDET"."COSTS", "ARINVDET"."TAX_GROUP", "ARINVDET"."EXM_OVERID", "ARINVDET"."SHIP_DATE", "ARINVDET"."WEIGHT", "ARINVDET"."PRINT", "ARINVDET"."AP_PARTIME", "ARINVDET"."PRINT_QUAN", "ARINVDET"."PRINT_UOM", "ARINVDET"."ACCOUNT", "ARINVDET"."WAREHOUSE", "ARINVDET"."AUTOID", "ARINVDET"."PCM_TYPE", "ARINVDET"."PCM_PERC", "ARINVDET"."MTO", "ARINVDET"."MTO_D_SYNC", "ARINVDET"."DROP_VEN", "ARINVDET"."DROP_PART", "ARINVDET"."DROP_AID", "ARINVDET"."PURC_METH", "ARINVDET"."C_PRICE", "ARINVDET"."C_UNIT", "ARINVDET"."FXLINE", "ARINVDET"."C_FORMULA", "ARINVDET"."WIDTH", "ARINVDET"."WIDTHD", "ARINVDET"."HEIGHT", "ARINVDET"."HEIGHTD", "ARINVDET"."DEM", "ARINVDET"."DEMD", "ARINVDET"."MANUAL_P", "ARINVDET"."MANUAL_C", "ARINVDET"."ROUND", "ARINVDET"."COMMENT", "ARINVDET"."EA_QUAN", "ARINVDET"."R_EA_QUAN", "ARINVDET"."REPORT_N", "ARINVDET"."RANDOM_W", "ARINVDET"."RANDOM_H", "ARINVDET"."ITEM_NUM", "ARINVDET"."FEET", "ARINVDET"."INCHESD", "ARINVDET"."INCHES", "ARINVDET"."C_MFG", "ARINVDET"."R_SERIAL", "ARINVDET"."SU_AUTOID", "ARINVDET"."TRADE_IN", "ARINVDET"."IN_LEVEL", "ARINVDET"."JOB_ID", "ARINVDET"."JOBSTG_ID", "ARINVDET"."AIA", "ARINVDET"."RETN_TYPE", "ARINVDET"."RETN_PERC", "ARINVDET"."INT_NOTE", "ARINVDET"."TAX_EXPL", "ARINVDET"."ON_SITE" 
                FROM "ARINVDET" 
                WHERE "ARINVDET"."INV_DATE" >= '2023-01-01' AND "ARINVDET"."PAR_TIME" = '' AND (SELECT "INVENTRY"."PROD_TYPE" 
                FROM "INVENTRY" 
                WHERE "INVENTRY"."ID" = "ARINVDET"."INVEN") != '' AND (SELECT "INVENTRY"."PROD_TYPE" 
                FROM "INVENTRY" 
                WHERE "INVENTRY"."ID" = "ARINVDET"."INVEN") != 'Vents' AND "ARINVDET"."INVEN" IS NOT NULL AND "ARINVDET"."INVEN" != '' AND ("ARINVDET"."AUTOID" NOT IN ('1L3KKNIGQ3GQCL01', 'Q6F01NHMDU9J0G11', 'PSRKR559J2C7HEH0', '4I86DSG9DK6JIO51', '0B8H1NHMDU9J0G11')) GROUP BY "ARINVDET"."ARINVDET_GUID", "ARINVDET"."RECNO5", "ARINVDET"."INVOICE", "ARINVDET"."ID", "ARINVDET"."DOC_TYPE", "ARINVDET"."DOC_AID", "ARINVDET"."INV_DATE", "ARINVDET"."QUAN", "ARINVDET"."SHIP", "ARINVDET"."M_QUAN", "ARINVDET"."ORIG_QUAN", "ARINVDET"."INVEN", "ARINVDET"."C_TYPE", "ARINVDET"."UNIT_MEAS", "ARINVDET"."DESCR", "ARINVDET"."UNIT", "ARINVDET"."PRICE", "ARINVDET"."SO_AMOUNT", "ARINVDET"."DISCOUNT", "ARINVDET"."SODISCOUNT", "ARINVDET"."TIMESTAMP", "ARINVDET"."PAR_TIME", "ARINVDET"."GPAR_TIME", "ARINVDET"."STATUS", "ARINVDET"."U_COST", "ARINVDET"."COSTS", "ARINVDET"."TAX_GROUP", "ARINVDET"."EXM_OVERID", "ARINVDET"."SHIP_DATE", "ARINVDET"."WEIGHT", "ARINVDET"."PRINT", "ARINVDET"."AP_PARTIME", "ARINVDET"."PRINT_QUAN", "ARINVDET"."PRINT_UOM", "ARINVDET"."ACCOUNT", "ARINVDET"."WAREHOUSE", "ARINVDET"."AUTOID", "ARINVDET"."PCM_TYPE", "ARINVDET"."PCM_PERC", "ARINVDET"."MTO", "ARINVDET"."MTO_D_SYNC", "ARINVDET"."DROP_VEN", "ARINVDET"."DROP_PART", "ARINVDET"."DROP_AID", "ARINVDET"."PURC_METH", "ARINVDET"."C_PRICE", "ARINVDET"."C_UNIT", "ARINVDET"."FXLINE", "ARINVDET"."C_FORMULA", "ARINVDET"."WIDTH", "ARINVDET"."WIDTHD", "ARINVDET"."HEIGHT", "ARINVDET"."HEIGHTD", "ARINVDET"."DEM", "ARINVDET"."DEMD", "ARINVDET"."MANUAL_P", "ARINVDET"."MANUAL_C", "ARINVDET"."ROUND", "ARINVDET"."COMMENT", "ARINVDET"."EA_QUAN", "ARINVDET"."R_EA_QUAN", "ARINVDET"."REPORT_N", "ARINVDET"."RANDOM_W", "ARINVDET"."RANDOM_H", "ARINVDET"."ITEM_NUM", "ARINVDET"."FEET", "ARINVDET"."INCHESD", "ARINVDET"."INCHES", "ARINVDET"."C_MFG", "ARINVDET"."R_SERIAL", "ARINVDET"."SU_AUTOID", "ARINVDET"."TRADE_IN", "ARINVDET"."IN_LEVEL", "ARINVDET"."JOB_ID", "ARINVDET"."JOBSTG_ID", "ARINVDET"."AIA", "ARINVDET"."RETN_TYPE", "ARINVDET"."RETN_PERC", "ARINVDET"."INT_NOTE", "ARINVDET"."TAX_EXPL", "ARINVDET"."ON_SITE" ORDER BY CASE "ARINVDET"."AUTOID" WHEN 'CHVN1KKAET2NF130' THEN 1 WHEN 'QF0P32IMDU9J0G11' THEN 2 ELSE -1 END

""")

all_objs = data.fetchall()

print(time.time() - start_time)